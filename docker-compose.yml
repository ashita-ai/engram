# =============================================================================
# Engram Docker Compose (Minimal)
# =============================================================================
# For MCP server usage with Claude Code.
#
# Usage:
#   docker compose up -d        # Start Qdrant + Engram MCP server
#
# API Key: Set OPENAI_API_KEY or ENGRAM_OPENAI_API_KEY in your shell or .env
# file. Either name works â€” engram accepts both.
#
# For full setup with DBOS durability and Prefect workflows:
#   docker compose -f docker-compose.full.yml up -d
# =============================================================================

services:
  qdrant:
    image: qdrant/qdrant:latest
    ports:
      - "6333:6333"
      - "6334:6334"
    volumes:
      - qdrant_data:/qdrant/storage
    environment:
      QDRANT__SERVICE__GRPC_PORT: 6334
  engram-mcp:
    build: .
    container_name: engram-mcp
    environment:
      ENGRAM_QDRANT_URL: http://qdrant:6333
      ENGRAM_OPENAI_API_KEY: ${ENGRAM_OPENAI_API_KEY:-${OPENAI_API_KEY:-}}
      ENGRAM_ANTHROPIC_API_KEY: ${ENGRAM_ANTHROPIC_API_KEY:-${ANTHROPIC_API_KEY:-}}
    depends_on:
      - qdrant
    stdin_open: true
    tty: true
    command: ["sleep", "infinity"]  # Keep container running for docker exec

volumes:
  qdrant_data:
    name: engram_qdrant_data  # Reuse existing volume if present
