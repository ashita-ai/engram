# =============================================================================
# Engram Docker Compose (Minimal)
# =============================================================================
# For MCP server usage with Claude Code.
#
# Usage:
#   docker compose up -d        # Start Qdrant + Engram MCP server
#
# Claude Code config (~/.claude/claude_desktop_config.json):
#   {
#     "mcpServers": {
#       "engram": {
#         "command": "docker",
#         "args": ["exec", "-i", "engram-mcp", "python", "-m", "engram.mcp"],
#         "env": {
#           "ENGRAM_OPENAI_API_KEY": "your-key-here"
#         }
#       }
#     }
#   }
#
# For full setup with DBOS durability and Prefect workflows:
#   docker compose -f docker-compose.full.yml up -d
# =============================================================================

services:
  qdrant:
    image: qdrant/qdrant:latest
    ports:
      - "6333:6333"
      - "6334:6334"
    volumes:
      - qdrant_data:/qdrant/storage
    environment:
      QDRANT__SERVICE__GRPC_PORT: 6334
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:6333/health"]
      interval: 10s
      timeout: 5s
      retries: 5

  engram-mcp:
    build: .
    container_name: engram-mcp
    environment:
      ENGRAM_QDRANT_URL: http://qdrant:6333
      ENGRAM_OPENAI_API_KEY: ${ENGRAM_OPENAI_API_KEY:-}
      ENGRAM_ANTHROPIC_API_KEY: ${ENGRAM_ANTHROPIC_API_KEY:-}
    depends_on:
      qdrant:
        condition: service_healthy
    stdin_open: true
    tty: true
    command: ["sleep", "infinity"]  # Keep container running for docker exec

volumes:
  qdrant_data:
